---
// Navbar component
const currentPath = Astro.url.pathname;
---

<nav class="fixed md:top-4 bottom-4 md:bottom-auto left-1/2 transform -translate-x-1/2 bg-white bg-opacity-80 backdrop-blur-lg shadow-xl rounded-full px-4 py-3 z-50">
  <div class="flex items-center justify-center space-x-6 md:space-x-10">
    <a href="/" class={`flex items-center space-x-1 md:space-x-2 transition-colors ${currentPath === '/' ? 'text-blue-600' : 'text-gray-800 hover:text-blue-600'}`}>
      <span class="material-icons text-sm md:text-base">home</span>
      <span class="text-sm md:text-base">Inicio</span>
    </a>
    <button id="search-btn" class={`flex items-center space-x-1 md:space-x-2 transition-colors text-gray-800 hover:text-blue-600`}>
      <span class="material-icons text-sm md:text-base">search</span>
      <span class="text-sm md:text-base">Buscar</span>
    </button>
    <a href="/swiper" class={`flex items-center space-x-1 md:space-x-2 transition-colors ${currentPath === '/swiper' ? 'text-blue-600' : 'text-gray-800 hover:text-blue-600'}`}>
      <span class="material-icons text-sm md:text-base">view_carousel</span>
      <span class="text-sm md:text-base">Swiper</span>
    </a>
    <a href="/favoritos" class={`flex items-center space-x-1 md:space-x-2 transition-colors ${currentPath === '/favoritos' ? 'text-blue-600' : 'text-gray-800 hover:text-blue-600'}`}>
      <span class="material-icons text-sm md:text-base">favorite</span>
      <span class="text-sm md:text-base">Favoritos</span>
    </a>
  </div>
</nav>

<!-- Search Dropdown -->
<div id="search-dropdown" class="fixed md:top-20 bottom-20 md:bottom-auto left-1/2 transform -translate-x-1/2 bg-white bg-opacity-90 backdrop-blur-lg shadow-xl rounded-full px-4 py-3 z-40 hidden min-w-80">
  <div class="flex items-center space-x-3">
    <span class="material-icons text-gray-500">search</span>
    <input
      type="text"
      id="search-input"
      placeholder="Buscar pelÃ­culas, series..."
      class="bg-transparent outline-none text-gray-800 placeholder-gray-500 flex-1"
    >
    <button
      id="search-submit"
      class="bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-700 transition-colors text-sm font-medium"
    >
      Buscar
    </button>
  </div>
</div>

<script>
  const searchBtn = document.getElementById('search-btn');
  const searchDropdown = document.getElementById('search-dropdown');
  const searchInput = document.getElementById('search-input');
  const searchSubmit = document.getElementById('search-submit');

  if (searchBtn && searchDropdown && searchInput && searchSubmit) {
    // Toggle search dropdown
    searchBtn.addEventListener('click', (e: Event) => {
      e.stopPropagation();
      searchDropdown.classList.toggle('hidden');
      if (!searchDropdown.classList.contains('hidden')) {
        searchInput.focus();
      }
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e: MouseEvent) => {
      if (!searchBtn.contains(e.target as Node) && !searchDropdown.contains(e.target as Node)) {
        searchDropdown.classList.add('hidden');
      }
    });

    // Handle search submission
    const performSearch = () => {
      const query = searchInput.value.trim();
      if (query) {
        window.location.href = `/buscar?q=${encodeURIComponent(query)}`;
      }
    };

    // Search on button click
    searchSubmit.addEventListener('click', performSearch);

    // Search on Enter key
    searchInput.addEventListener('keypress', (e: KeyboardEvent) => {
      if (e.key === 'Enter') {
        performSearch();
      }
    });
  } else {
    console.error('Search elements not found');
  }
</script>