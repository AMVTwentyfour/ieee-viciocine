---
// Navbar component
const currentPath = Astro.url.pathname;
---

<nav class="fixed md:top-4 bottom-4 md:bottom-auto left-1/2 transform -translate-x-1/2 bg-[rgb(var(--bg))] bg-opacity-80 backdrop-blur-lg shadow-xl rounded-full px-4 py-3 z-50">
  <div class="flex items-center justify-center space-x-6 md:space-x-10">
    <a href="/" class={`flex items-center space-x-1 md:space-x-2 transition-colors ${currentPath === '/' ? 'text-blue-600' : 'text-[rgb(var(--text))] hover:text-blue-600'}`}>
      <span class="material-icons text-sm md:text-base">home</span>
      <span class="text-sm md:text-base">Inicio</span>
    </a>
    <button id="search-btn" class={`flex items-center space-x-1 md:space-x-2 transition-colors text-[rgb(var(--text))] hover:text-blue-600`}>
      <span class="material-icons text-sm md:text-base">search</span>
      <span class="text-sm md:text-base">Buscar</span>
    </button>
    <a href="/swiper" class={`flex items-center space-x-1 md:space-x-2 transition-colors ${currentPath === '/swiper' ? 'text-blue-600' : 'text-[rgb(var(--text))] hover:text-blue-600'}`}>
      <span class="material-icons text-sm md:text-base">view_carousel</span>
      <span class="text-sm md:text-base">Swiper</span>
    </a>
    <a href="/favoritos" class={`flex items-center space-x-1 md:space-x-2 transition-colors ${currentPath === '/favoritos' ? 'text-blue-600' : 'text-[rgb(var(--text))] hover:text-blue-600'}`}>
      <span class="material-icons text-sm md:text-base">favorite</span>
      <span class="text-sm md:text-base">Favoritos</span>
    </a>
    <button id="settings-btn" class={`flex items-center space-x-1 md:space-x-2 transition-colors text-[rgb(var(--text))] hover:text-blue-600`}>
      <span class="material-icons text-sm md:text-base">settings</span>
      <span class="text-sm md:text-base">Config</span>
    </button>
  </div>
</nav>

<!-- Search Dropdown -->
<div id="search-dropdown" class="fixed md:top-20 bottom-20 md:bottom-auto left-1/2 transform -translate-x-1/2 bg-[rgb(var(--bg))] bg-opacity-90 backdrop-blur-lg shadow-xl rounded-full px-4 py-3 z-40 hidden min-w-80">
  <div class="flex items-center space-x-3">
    <span class="material-icons text-gray-500">search</span>
    <input
      type="text"
      id="search-input"
      placeholder="Buscar pelÃ­culas, series..."
      class="bg-transparent outline-none text-[rgb(var(--text))] placeholder-gray-500 flex-1"
    >
    <button
      id="search-submit"
      class="bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-700 transition-colors text-sm font-medium"
    >
      Buscar
    </button>
  </div>
</div>

<!-- Settings Dropdown -->
<div id="settings-dropdown" class="fixed md:top-20 bottom-20 md:bottom-auto left-1/2 transform -translate-x-1/2 bg-[rgb(var(--bg))] bg-opacity-90 backdrop-blur-lg shadow-xl rounded-lg px-4 py-3 z-40 hidden min-w-64">
  <div class="flex items-center justify-between">
    <span class="text-[rgb(var(--text))]">Tema</span>
    <button id="theme-toggle" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
      <span id="theme-slider" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span>
    </button>
  </div>
</div>

<script>
  const searchBtn = document.getElementById('search-btn');
  const searchDropdown = document.getElementById('search-dropdown');
  const searchInput = document.getElementById('search-input');
  const searchSubmit = document.getElementById('search-submit');

  const settingsBtn = document.getElementById('settings-btn');
  const settingsDropdown = document.getElementById('settings-dropdown');
  const themeToggle = document.getElementById('theme-toggle');
  const themeSlider = document.getElementById('theme-slider');

  // Function to update theme
  const updateTheme = (isDark: boolean) => {
    console.log('Updating theme to', isDark);
    document.documentElement.classList.toggle('dark', isDark);
    console.log('Class list:', document.documentElement.classList.toString());
    console.log('Color scheme:', getComputedStyle(document.documentElement).getPropertyValue('--color-scheme'));
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    themeSlider.classList.toggle('translate-x-5', isDark);
    themeToggle.classList.toggle('bg-blue-600', isDark);
    themeToggle.classList.toggle('bg-gray-200', !isDark);
  };

  // Initialize theme slider
  const isDark = document.documentElement.classList.contains('dark');
  updateTheme(isDark);

  if (searchBtn && searchDropdown && searchInput && searchSubmit) {
    // Toggle search dropdown
    searchBtn.addEventListener('click', (e: Event) => {
      e.stopPropagation();
      searchDropdown.classList.toggle('hidden');
      if (!searchDropdown.classList.contains('hidden')) {
        searchInput.focus();
      }
      // Close settings if open
      settingsDropdown.classList.add('hidden');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e: MouseEvent) => {
      if (!searchBtn.contains(e.target as Node) && !searchDropdown.contains(e.target as Node)) {
        searchDropdown.classList.add('hidden');
      }
    });

    // Handle search submission
    const performSearch = () => {
      const query = searchInput.value.trim();
      if (query) {
        window.location.href = `/buscar?q=${encodeURIComponent(query)}`;
      }
    };

    // Search on button click
    searchSubmit.addEventListener('click', performSearch);

    // Search on Enter key
    searchInput.addEventListener('keypress', (e: KeyboardEvent) => {
      if (e.key === 'Enter') {
        performSearch();
      }
    });
  } else {
    console.error('Search elements not found');
  }

  if (settingsBtn && settingsDropdown && themeToggle && themeSlider) {
    // Toggle settings dropdown
    settingsBtn.addEventListener('click', (e: Event) => {
      e.stopPropagation();
      settingsDropdown.classList.toggle('hidden');
      // Close search if open
      searchDropdown.classList.add('hidden');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e: MouseEvent) => {
      if (!settingsBtn.contains(e.target as Node) && !settingsDropdown.contains(e.target as Node)) {
        settingsDropdown.classList.add('hidden');
      }
    });

    // Theme toggle
    themeToggle.addEventListener('click', () => {
      console.log('Theme toggle clicked');
      const isCurrentlyDark = document.documentElement.classList.contains('dark');
      console.log('Currently dark:', isCurrentlyDark);
      updateTheme(!isCurrentlyDark);
    });
  } else {
    console.error('Settings elements not found');
  }
</script>