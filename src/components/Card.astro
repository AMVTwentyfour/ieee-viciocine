---
export interface Props {
  movie: {
    Title: string;
    Year: string;
    Poster: string;
    imdbID: string;
  };
}

const { movie } = Astro.props;
const placeholderSmall = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2NjIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5ObyBJbWFnZTwvdGV4dD48L3N2Zz4=';
---

<div class="shrink-0 w-40 md:w-auto bg-linear-to-br from-white to-gray-50 bg-opacity-90 backdrop-blur-xl rounded-xl overflow-hidden hover:scale-105 transition-all duration-500 ease-out animate-fade-in-up cursor-pointer card h-64 relative" data-imdbid={movie.imdbID}>
  <button class="absolute top-2 right-2 bg-white bg-opacity-80 rounded-full w-8 h-8 flex items-center justify-center hover:bg-opacity-100 transition-all favorite-btn" data-imdbid={movie.imdbID}>
    <span class="material-icons text-red-500 text-base leading-none">favorite_border</span>
  </button>
  <img src={movie.Poster !== 'N/A' ? movie.Poster : placeholderSmall} alt={movie.Title} class="w-full h-48 object-cover rounded-t-xl" loading="lazy">
  <div class="p-4">
    <h3 class="font-semibold text-sm truncate">{movie.Title}</h3>
    <p class="text-gray-600 text-xs">{movie.Year}</p>
  </div>
</div>

<script>
  import { addFavorite, removeFavorite, isFavorite } from '../lib/favorites.js';

  document.addEventListener('DOMContentLoaded', () => {
    const favoriteBtns = document.querySelectorAll('.favorite-btn');
    favoriteBtns.forEach(btn => {
      const imdbID = btn.getAttribute('data-imdbid');
      if (imdbID) {
        const icon = btn.querySelector('.material-icons');
        if (icon) {
          if (isFavorite(imdbID)) {
            icon.textContent = 'favorite';
            icon.classList.add('text-red-600');
          }
        }

        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          if (imdbID) {
            if (isFavorite(imdbID)) {
              removeFavorite(imdbID);
              if (icon) {
                icon.textContent = 'favorite_border';
                icon.classList.remove('text-red-600');
              }
            } else {
              addFavorite(imdbID);
              if (icon) {
                icon.textContent = 'favorite';
                icon.classList.add('text-red-600');
              }
            }
          }
        });
      }
    });
  });
</script>